<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="编辑用工具和代码"><meta name="keywords" content=""><meta name="author" content="Gleayveon"><meta name="copyright" content="Gleayveon"><title>编辑用工具和代码 | Gleayveonの杂物箱</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="/css/uma-sprite.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '6.0.0'
} </script><link rel="alternate" href="/atom.xml" title="Gleayveonの杂物箱" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%8A%E8%B5%9B%E9%A9%AC%E5%A8%98-Pretty-Derby%E3%80%8B%E6%B8%B8%E6%88%8F%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">《赛马娘 Pretty Derby》游戏资源提取简明教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E6%9D%90%E6%96%99%E4%B8%8E%E5%B7%A5%E5%85%B7%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">原材料与工具准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2ID%E5%AF%B9%E7%85%A7"><span class="toc-number">1.2.</span> <span class="toc-text">角色ID对照</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E9%A2%91%E6%8F%90%E5%8F%96%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.3.</span> <span class="toc-text">音频提取步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E7%BA%B9%E7%90%86%E3%80%81%E8%B4%B4%E5%9B%BE%E3%80%81%E6%A8%A1%E5%9E%8B%E6%8F%90%E5%8F%96%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.4.</span> <span class="toc-text">游戏纹理、贴图、模型提取步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EKirikiri2%E5%BC%95%E6%93%8E%E7%9A%84%E6%B8%B8%E6%88%8F%E4%B9%8B%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">基于Kirikiri2引擎的游戏之资源提取简明教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E6%9D%90%E6%96%99%E4%B8%8E%E5%B7%A5%E5%85%B7%E5%87%86%E5%A4%87-1"><span class="toc-number">2.1.</span> <span class="toc-text">原材料与工具准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96"><span class="toc-number">2.2.</span> <span class="toc-text">资源提取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E6%8F%90%E5%8F%96"><span class="toc-number">2.2.1.</span> <span class="toc-text">文本提取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CG%E6%8F%90%E5%8F%96"><span class="toc-number">2.2.2.</span> <span class="toc-text">CG提取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%8B%E7%BB%98%E6%8F%90%E5%8F%96"><span class="toc-number">2.2.3.</span> <span class="toc-text">立绘提取</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Gleayveon</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">5</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/top_img.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gleayveonの杂物箱</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">编辑用工具和代码</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-12</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="《赛马娘-Pretty-Derby》游戏资源提取简明教程"><a href="#《赛马娘-Pretty-Derby》游戏资源提取简明教程" class="headerlink" title="《赛马娘 Pretty Derby》游戏资源提取简明教程"></a>《<a target="_blank" rel="noopener" href="https://zh.moegirl.org.cn/%E8%B5%9B%E9%A9%AC%E5%A8%98_Pretty_Derby">赛马娘 Pretty Derby</a>》游戏资源提取简明教程</h2><ul>
<li><strong>本部分内容引自<a target="_blank" rel="noopener" href="https://zh.moegirl.org.cn/User:Plkm160/%E7%BC%96%E8%BE%91%E7%94%A8%E5%B7%A5%E5%85%B7%E5%92%8C%E4%BB%A3%E7%A0%81#%E3%80%8A%E8%B5%9B%E9%A9%AC%E5%A8%98_Pretty_Derby%E3%80%8B%E6%B8%B8%E6%88%8F%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B">编辑用工具和代码</a></strong></li>
</ul>
<h3 id="原材料与工具准备"><a href="#原材料与工具准备" class="headerlink" title="原材料与工具准备"></a>原材料与工具准备</h3><p><em>考虑到DMM版更容易查看游戏数据，结构和命名规则也更为清晰，本教程将基于DMM版编写</em></p>
<p>准备材料：</p>
<ul>
<li>一份DMM版赛马娘游戏数据</li>
<li>一份可以处理SQLite format 3 数据库的工具，如<a target="_blank" rel="noopener" href="https://sqlitebrowser.org/dl">DB Browser for SQLite</a></li>
<li>任意一款Unity3D资源解包工具。此处推荐<a target="_blank" rel="noopener" href="https://github.com/Perfare/AssetStudio">AssetStudio</a>，其优点在于可视化和支持预览，在解析Unity资源束（<code>.unity3d</code>和<code>.asset</code>文件）和查看、导出各类资源文件时很方便。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/vgmstream/vgmstream">vgmstream</a>：多功能游戏音频解码工具，下载页面在<a target="_blank" rel="noopener" href="https://vgmstream.org/downloads">这里</a>。其中的命令行工具适合在脚本中调用，而foobar2000组件可以使foobar2000具备直接解密并播放游戏音频的功能。</li>
<li>foobar2000：高度可扩展的音频播放器。搭配上述vgmstream插件可以直接解密并播放常见游戏的<code>.acb</code>和<code>.awb</code>文件。<ul>
<li>原生foobar2000支持的音频格式有限。如果希望将音频转换为wav之外的格式（如mp3&#x2F;flac&#x2F;ape），请额外安装<a target="_blank" rel="noopener" href="https://www.foobar2000.org/encoderpack">官方提供的解码包</a>。</li>
</ul>
</li>
</ul>
<h3 id="角色ID对照"><a href="#角色ID对照" class="headerlink" title="角色ID对照"></a>角色ID对照</h3><a href="/2022/02/12/%E8%B5%9B%E9%A9%AC%E5%A8%98-Pretty-Derby-%E8%A7%92%E8%89%B2ID%E5%AF%B9%E7%85%A7/" title="赛马娘 Pretty Derby 角色ID对照">赛马娘 Pretty Derby 角色ID对照</a>
<p>角色ID一般为四位数，其中以1开头的ID(<code>1***</code>)为玩家可获得的马娘，2开头的为游戏中NPC所拥有的马娘(如<a target="_blank" rel="noopener" href="https://zh.moegirl.org.cn/%E5%BF%AB%E4%B9%90%E7%B1%B3%E5%8F%AF">快乐米可</a>)，8开头的为参加各类比赛中“凑数”用的马娘的ID(<del>牡蛎马</del>)，9开头的ID为游戏中的NPC。</p>
<h3 id="音频提取步骤"><a href="#音频提取步骤" class="headerlink" title="音频提取步骤"></a>音频提取步骤</h3><p>游戏默认将数据下载至<code>C:\Users\*你的用户名*\AppData\LocalLow\Cygames\umamusume</code>。此目录下有一个大小＞30MB、名为<code>meta</code>的文件。游戏数据位于<code>dat</code>子目录中，文件名皆为32位散列值，这些文件按照文件名前2位组织起来，归档至相应的文件夹中。</p>
<ul>
<li>用数据库工具打开meta文件，查看其中的表a。表a包含了游戏数据的相关信息，以其中的一行为例：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th align="center">7</th>
<th align="center">8</th>
<th align="center">9</th>
<th align="center">10</th>
</tr>
</thead>
<tbody><tr>
<td align="center">62958</td>
<td align="center">sound&#x2F;b&#x2F;snd_bgm_am006.awb</td>
<td align="center">2</td>
<td align="center">2219552</td>
<td align="center">6379557874288396605</td>
<td align="center">YSR2LFCD4HVWEYUV4LUR43BMHWJJSEZ4</td>
<td align="center">sound</td>
<td align="center">11</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
</tbody></table>
<p>注意到第1列是数据的ID；第2列中<code>snd_bgm_am006.awb</code>是资源的真实名字；第4列是文件大小；第6列是32位散列值，也就是上文所说<code>dat</code>子目录中的文件名；第7列是数据的类型。因此，<strong>在表a里确定了想要的文件之后，就可以按照对应的32位散列函数值去dat文件夹里找文件，并将文件名改为第2列中的文件名</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3.exe -csv &quot;meta&quot; &quot;select * from A&quot; &gt; &quot;meta.csv&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>查找到所需的文件后，如果后缀为<code>.unity3d</code>或<code>.asset</code>则需要用AssetStudio解包，这种情况多出现于游戏纹理与贴图。如果不是，则直接进行相应的处理即可。</li>
</ul>
<p>赛马娘使用了CRIWARE音视频解码技术，相关的音频文件有<code>.awb</code>和<code>.acb</code>两种。而对于本游戏而言，<code>.awb</code>文件的大小较大，内容为音频本身；而<code>.acb</code>文件（大小为几KB至几十KB）则记录了<code>.awb</code>的信息。一般来说只需要关注<code>.awb</code>即可。</p>
<p>注：如果读取.awb文件同时目录里存在同名的<code>.acb</code>文件，就能显示出<code>.awb</code>文件的名字。在<code>.awb</code>文件包含多段音频时可以显示出<code>.acb</code>文件的作用，如果有<code>.acb</code>存在就会显示出每一段的文件名，但事实上<code>.acb</code>的用处也没有那么大。<br><em>提示：赛马娘的音频数据中，<code>snd_bgm_****</code>为游戏BGM，其中<code>snd_bgm_live_****</code>为游戏内歌曲，<code>snd_mfx_****</code>为开场号角。</em></p>
<p>可以通过两种方法解码和转换游戏音频：</p>
<ul>
<li><p>使用安装了vgmstream插件的foobar2000。此方法的优点为界面友好、容易上手。</p>
<ol>
<li>下载并安装foobar2000。</li>
<li>下载vgmstream插件，文件名为<code>foo_input_vgmstream.fb2k-component</code>。</li>
<li>打开foobar2000，依次点击<code>File</code>→<code>Preference</code>，在弹出的窗口左侧中选择<code>Components</code>，而后点击右下角的<code>Install...</code>，选择<code>foo_input_vgmstream.fb2k-component</code>并安装。</li>
<li>将<code>.awb</code>文件拖入播放列表中，即可直接播放。</li>
<li>若要转换文件，可右击播放列表的项目，选择<code>Convert</code>→<code>...</code>，根据需要将音频转换为其他可播放格式。若要将音频转换为wav之外的格式（如mp3&#x2F;flac&#x2F;ape），请额外安装官方提供的解码包。</li>
</ol>
</li>
<li><p>使用vgmstream命令行工具。此方法的优点为可以搭配脚本实现批量和自动化处理。</p>
<ol>
<li>下载vgmstream命令行工具并解压，其中的<code>test.exe</code>即为主程序。将<code>test.exe</code>重命名为<code>vgmstream.exe</code>备用。</li>
<li>程序的基本用法为<code>vgmstream.exe [-o 目标文件.wav] &lt;参数&gt; 源文件</code>。另外可以用<code>-l</code>指定循环次数（不指定则默认为循环2次），可以用<code>-f</code>指定淡出时间（不指定则默认为10s），在音频存在多段时可以用<code>-s</code>指定处理其中的哪一段（不指定则默认为第1段）。例如，<code>vgmstream.exe -o snd_bgm_am006.wav -l 10 -f 25 snd_bgm_am006.awb</code>表示处理<code>snd_bgm_am006.awb</code>，循环10次并在结束15s前慢慢淡出，导出为<code>snd_bgm_am006.wav</code>。</li>
</ol>
</li>
<li><p>制作特定角色live歌曲音频<br><em>只限于该角色拥有此live的音源</em><br>*以制作米浴(<code>chr_1030</code>)的うまぴょい伝説(<code>live_1001</code>)独唱音频为例</p>
<ol>
<li>提取出目标live的伴奏部分<code>snd_bgm_live_1001_oke_01</code>，其中<code>oke_1</code>带有call的和声版伴奏，<code>oke_02</code>是不带call的和声版伴奏</li>
<li>提取所选择的赛马娘的独唱音轨<code>snd_bgm_live_1001_chara_1030_01</code></li>
<li>将音频解码并转换为wav格式（或其他常见格式）</li>
<li>使用音频剪辑软件将其合并<br>*可选：将所选择的赛马娘们按需要分配各自的独唱歌词</li>
</ol>
</li>
</ul>
<h3 id="游戏纹理、贴图、模型提取步骤"><a href="#游戏纹理、贴图、模型提取步骤" class="headerlink" title="游戏纹理、贴图、模型提取步骤"></a>游戏纹理、贴图、模型提取步骤</h3><p>将<code>C:\Users\*你的用户名*\AppData\LocalLow\Cygames\umamusume</code>目录下的<code>dat</code>文件夹拖入AssetStudio中，待加载完成后选择<code>Asset list</code>，选择所寻找的文件。</p>
<p><strong>支援卡(<code>tex_support_card_xxxxx</code>)以正方形(2048*2048)比例储存，需要自行拉伸至正常比例</strong></p>
<h2 id="基于Kirikiri2引擎的游戏之资源提取简明教程"><a href="#基于Kirikiri2引擎的游戏之资源提取简明教程" class="headerlink" title="基于Kirikiri2引擎的游戏之资源提取简明教程"></a>基于Kirikiri2引擎的游戏之资源提取简明教程</h2><p><em>教程基于Steam国际中文版的千恋＊万花编写</em></p>
<h3 id="原材料与工具准备-1"><a href="#原材料与工具准备-1" class="headerlink" title="原材料与工具准备"></a>原材料与工具准备</h3><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/morkt/GARbro">GARbro</a>。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/UlyssesWu/FreeMote">PsbDecompile</a></li>
<li></li>
</ol>
<h3 id="资源提取"><a href="#资源提取" class="headerlink" title="资源提取"></a>资源提取</h3><p>启动GARbro后输入游戏安装目录，加载完成后可以在软件界面中看到游戏目录中的文件名，其中各类资源均按类型分类存放于各<code>.xp3</code>文件中。<br>其中，<code>bgimage.xp3</code>存放各种背景图片，<code>bgm.xp3</code>存放游戏中的背景音乐，<code>evimage.xp3</code>存放游戏CG插画，<code>fgimage.xp3</code>存放角色贴图，<code>scn.xp3</code>存放游戏内文本文件，<code>video.xp3</code>存放视频，<code>voice.xp3</code>存放角色语音。<br>bgm、视频、角色语音在提取后为常见格式，无需进一步处理。</p>
<h4 id="文本提取"><a href="#文本提取" class="headerlink" title="文本提取"></a>文本提取</h4><ol>
<li>使用GARbro在<code>scn.xp3</code>中将目标文本文件提取出来，此时提取出来的文本文件应为<code>.ks.scn</code>格式的文件。</li>
<li>将提取出来的<code>.ks.scn</code>格式的文本文件拖拽到PsbDecompile上，在弹出的命令行界面自动关闭后在文本文件的目录中会出现拓展名分别为<code>.ks</code>、<code>.ks.resx</code>的两个JSON源文件，其中<code>.ks</code>文件便包含游戏内的文本，使用合适的编辑器便可打开。（如Visual Studio Code）</li>
</ol>
<hr>
<p><strong><center><font face="黑体" size="10">Underconstruction</font></center></strong></p>
<h4 id="CG提取"><a href="#CG提取" class="headerlink" title="CG提取"></a>CG提取</h4><h4 id="立绘提取"><a href="#立绘提取" class="headerlink" title="立绘提取"></a>立绘提取</h4></div></article><div class="post-copyright"><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本站全部内容禁止商业使用。文本内容除另有声明外，均在 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议下提供。转载请标注来源网页链接</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/02/12/%E8%B5%9B%E9%A9%AC%E5%A8%98-Pretty-Derby-%E8%A7%92%E8%89%B2ID%E5%AF%B9%E7%85%A7/"><i class="fa fa-chevron-left">  </i><span>赛马娘 Pretty Derby 角色ID对照</span></a></div><div class="next-post pull-right"><a href="/2022/02/12/hello-world/"><span>Hello World</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/img/top_img.png)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By Gleayveon</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>